<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>task(3w)</title>
  <!-- Reference URL: https://getbootstrap.com/docs/5.2/examples/checkout/ -->

  <style>
    :root{
      --text:#212529; --muted:#6c757d; --border:#dee2e6; --control-border:#ced4da;
      --bg:#ffffff; --light-blue:#6ea8fe; --light-blue-strong:#4f97ff;
      --success:#198754; --danger:#d6336c; --white:#fff;
      --container:960px; --gap:3rem; --radius:.5rem; --ctrl-radius:.375rem;
      --cart-title-size:1.1rem;
    }

    /* 중앙 컨테이너 + 2열 */
    html,body{height:100%;}
    body{
      margin:0; color:var(--text); background:var(--bg);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans,Apple SD Gothic Neo,Helvetica,Arial,sans-serif;
      line-height:1.5; max-width:var(--container); margin-inline:auto; padding:2rem 1rem;
      display:grid; grid-template-columns:2fr 1fr;
      grid-template-areas:"header header" "lead lead" "form aside"; gap:var(--gap);
    }

    /* 헤더/리드 중앙 정렬 */
    h1{ grid-area:header; margin:0; text-align:center; font-size:clamp(24px,4vw,32px); font-weight:700; }
    body > div:first-of-type{ grid-area:lead; color:var(--muted); text-align:center; max-width:720px; margin:.5rem auto 0; }

    /* 좌측 폼(카드 X) */
    form[name="checkoutForm"]{ grid-area:form; }
    fieldset{ border:0; margin:0 0 1.25rem; padding:0; }
    legend{ font-weight:700; font-size:1.05rem; margin:0 0 .5rem; }
    form[name="checkoutForm"] fieldset > div{ margin-bottom:.9rem; }
    label{ display:inline-block; margin-bottom:.35rem; font-weight:600; }

    /* Username input-group 연결 */
    .input-group{ display:flex; align-items:stretch; width:100%; }
    .input-group .prefix{
      display:inline-flex; align-items:center; padding:.5rem .75rem;
      border:1px solid var(--control-border); border-right:0;
      border-top-left-radius:var(--ctrl-radius); border-bottom-left-radius:var(--ctrl-radius);
      background:#e9ecef; color:#495057; font-weight:700;
    }
    .input-group input{
      flex:1; padding:.5rem .75rem;
      border:1px solid var(--control-border);
      border-top-left-radius:0; border-bottom-left-radius:0;
      background:#fff; color:var(--text); font:inherit; outline:none;
    }

    /* 공통 컨트롤 */
    input[type="text"], input[type="email"], input[type="date"], input[type="color"], select, textarea{
      width:100%; padding:.625rem .75rem; border:1px solid var(--control-border);
      border-radius:var(--ctrl-radius); background:#fff; color:var(--text); font:inherit; outline:none;
    }
    textarea{ resize:vertical; }
    input[type="color"]{ height:40px; padding:4px; }
    form[name="checkoutForm"] fieldset > div > label + input + div{ color:var(--muted); font-size:.92rem; margin-top:.25rem; }
    input[type="radio"], input[type="checkbox"]{ margin-right:.4rem; transform:translateY(1px); }
    form[name="checkoutForm"] fieldset > div > label + label{ margin-left:.75rem; }

    /* 버튼 */
    form[name="checkoutForm"] > div:last-child{ display:flex; gap:.5rem; justify-content:flex-end; margin-top:.25rem; }
    button[type="submit"], button[type="reset"]{ padding:.75rem 1rem; border-radius:.5rem; font-weight:700; cursor:pointer; }
    button[type="submit"]{ border:1px solid var(--light-blue-strong); background:var(--light-blue-strong); color:var(--white); }
    button[type="submit"]:hover{ filter:brightness(.95); }
    button[type="reset"]{ border:1px solid var(--border); background:#fff; color:var(--text); }
    button[type="reset"]:hover{ background:#f1f3f5; }

    /* 포커스 */
    input:focus, select:focus, textarea:focus{ border-color:#86b7fe; box-shadow:0 0 0 .25rem rgba(13,110,253,.25); }

    /* 우측 Your cart */
    aside{ grid-area:aside; align-self:start; position:relative; }
    #cartTitle{
      margin:0 0 .5rem; font-size:var(--cart-title-size); font-weight:700; color:var(--light-blue);
      position:relative; /* 배지 기준점 */
    }
    .item-count{ display:none; } 
    #cartTitle::after{
      content:"3"; position:absolute; right:calc(1rem + 10px); top:50%; transform:translateY(-50%);
      display:inline-block; padding:.25em .6em; font-size:var(--cart-title-size); font-weight:700; line-height:1;
      color:#fff; background:var(--light-blue); border-radius:999px; box-shadow:0 1px 0 rgba(0,0,0,.05);
    }

    /* 카드(리스트 + 프로모 폼) */
    aside ul{
      list-style:none; margin:0; padding:0 1rem; background:#fff;
      border:1px solid var(--border); border-radius:var(--radius);
    }
    aside ul.js-hover{ border-color:#b6d4fe !important; box-shadow:inset 0 0 0 3px rgba(13,110,253,.15); } /* JS hover 효과 */
    aside li{ padding:.75rem 0; border-bottom:1px solid var(--border); }
    aside li:last-child{ border-bottom:0; }
    aside li > strong{ font-weight:600; }
    aside li > span{ float:right; margin-left:.75rem; font-weight:600; }
    aside li > div{ clear:both; margin-top:.25rem; color:var(--muted); font-size:.92rem; }

    /* Promo code 행만 배경 연회색 + 초록 텍스트 */
    aside ul li:nth-child(4){ background:#f8f9fa; }
    aside ul li:nth-child(4) *{ color:var(--success) !important; font-weight:600; }

    /* Total: 금액만 볼드, 레이블은 일반 */
    aside ul li:last-child strong{ font-weight:500; }
    aside ul li:last-child span b{ font-weight:800; }

    /* Promo code 입력 폼: 카드 하단 접합 */
    form[name="promoForm"]{
      display:flex; gap:.5rem; background:#fff; border:1px solid var(--border); border-top:0;
      border-bottom-left-radius:var(--radius); border-bottom-right-radius:var(--radius);
      padding:.75rem 1rem; margin-top:-.25rem;
    }
    form[name="promoForm"] label{
      position:absolute!important; clip:rect(1px,1px,1px,1px); width:1px; height:1px; overflow:hidden; white-space:nowrap;
    }
    form[name="promoForm"] input[type="text"]{
      flex:1; padding:.625rem .75rem; border:1px solid var(--control-border); border-radius:var(--ctrl-radius);
      font:inherit; outline:none; background:#fff; color:var(--text);
    }
    form[name="promoForm"] button{
      padding:.625rem .9rem; border:1px solid var(--light-blue-strong); background:var(--light-blue-strong);
      color:#fff; border-radius:var(--ctrl-radius); font-weight:600; cursor:pointer;
    }
    form[name="promoForm"] button:hover{ filter:brightness(.95); }

    /* Lab3: JS 검증 표시 */
    .error-msg{ margin-top:.35rem; font-size:.9rem; color:var(--danger); }
    .js-invalid{ border-color:#f03e3e !important; background:#fff5f5 !important; }
    .js-valid{ border-color:#37b24d !important; background:#f4fff6 !important; }

    /* 반응형 */
    @media (max-width: 992px){
      body{ grid-template-columns:1fr; grid-template-areas:"header" "lead" "form" "aside"; }
    }
  </style>
</head>
<body>
  <h1>Checkout form</h1>
  <div> Below is an example form built entirely with Bootstrap's form controls. Each required form group has a validation state that can be trigged by attempting to sumbmit the form without completing it.</div>

  <aside aria-labelledby="cartTitle">
    <h2 id="cartTitle">Your cart <span class="item-count">(3)</span></h2>

    <ul>
      <li>
        <strong>Product name</strong>
        <span>$12</span>
        <div>Brief description</div>
      </li>
      <li>
        <strong>Second product</strong>
        <span>$8</span>
        <div>Brief description</div>
      </li>
      <li>
        <strong>Third item</strong>
        <span>$5</span>
        <div>Brief description</div>
      </li>
      <li>
        <strong>Promo code</strong>
        <span>-$5</span>
        <div>EXAMPLECODE</div>
      </li>
      <li>
        <strong>Total (USD)</strong>
        <span><b>$20</b></span>
      </li>
    </ul>

    <!-- Promo code -->
    <form action="#" method="get" name="promoForm">
      <label for="promo">Promo code</label>
      <input type="text" id="promo" name="promo" placeholder="Promo code" />
      <button type="submit">Redeem</button>
    </form>
  </aside>

  <!-- Billing Address -->
  <form action="#" method="get" name="checkoutForm">
    <fieldset>
      <legend>Billing Address</legend>

      <!-- text -->
      <div>
        <label for="firstName">First name</label>
        <input type="text" id="firstName" name="firstName" required />
      </div>

      <!-- text -->
      <div>
        <label for="lastName">Last name</label>
        <input type="text" id="lastName" name="lastName" required />
      </div>

      <div>
        <label for="username">Username</label>
        <div class="input-group">
          <span class="prefix" aria-hidden="true">@</span>
          <input type="text" id="username" name="username" placeholder="Username" list="userSuggestions" required />
        </div>
        <datalist id="userSuggestions">
          <option value="apple_user"></option>
          <option value="banana_user"></option>
          <option value="grape_user"></option>
          <option value="orange_user"></option>
        </datalist>
      </div>

      <!-- email -->
      <div>
        <label for="email">Email (Optional)</label>
        <input type="email" id="email" name="email" placeholder="you@example.com" />
      </div>

      <!-- address -->
      <div>
        <label for="address1">Address</label>
        <input type="text" id="address1" name="address1" placeholder="1234 Main St" required />
      </div>

      <!-- address2 -->
      <div>
        <label for="address2">Address 2(Optional)</label>
        <input type="text" id="address2" name="address2" placeholder="Apartment or suite" />
      </div>

      <!-- select + optgroup -->
      <div>
        <label for="country">Country</label>
        <select id="country" name="country" required>
          <option value="">Choose...</option>
          <optgroup label="Asia">
            <option value="KR">Korea</option>
            <option value="JP">Japan</option>
            <option value="CN">China</option>
          </optgroup>
          <optgroup label="North America">
            <option value="US">United States</option>
            <option value="CA">Canada</option>
          </optgroup>
          <optgroup label="Europe">
            <option value="DE">Germany</option>
            <option value="FR">France</option>
          </optgroup>
        </select>
      </div>

      <!-- select -->
      <div>
        <label for="state">State/Province</label>
        <select id="state" name="state" required>
          <option value="">Choose...</option>
          <option value="state1">State 1</option>
          <option value="state2">State 2</option>
          <option value="state3">State 3</option>
        </select>
      </div>

      <!-- text -->
      <div>
        <label for="zip">Zip</label>
        <input type="text" id="zip" name="zip" required />
      </div>

      <!-- checkbox -->
      <div>
        <label>
          <input type="checkbox" id="sameAddress" name="sameAddress" />
          Shipping address is the same as my billing address
        </label>
      </div>

      <!-- checkbox -->
      <div>
        <label>
          <input type="checkbox" id="saveInfo" name="saveInfo" />
          Save this information for next time
        </label>
      </div>
    </fieldset>

    <fieldset>
      <legend>Payment</legend>

      <!-- radio -->
      <div>
        <span>Payment</span>
        <label><input type="radio" name="paymentMethod" value="credit" required /> Credit card</label>
        <label><input type="radio" name="paymentMethod" value="debit" /> Debit card</label>
        <label><input type="radio" name="paymentMethod" value="paypal" /> PayPal</label>
      </div>

      <!-- text -->
      <div>
        <label for="ccName">Name on card</label>
        <input type="text" id="ccName" name="ccName" required />
        <div>Full name as displayed on card</div>
      </div>

      <!-- text -->
      <div>
        <label for="ccNumber">Credit card number</label>
        <input type="text" id="ccNumber" name="ccNumber"  required />
      </div>

      <!-- text -->
      <div>
        <label for="ccExpiration">Expiration</label>
        <input type="text" id="ccExpiration" name="ccExpiration" required />
      </div>

      <!-- text -->
      <div>
        <label for="ccCvv">CVV</label>
        <input type="text" id="ccCvv" name="ccCvv" required />
      </div>
    </fieldset>

    <!-- date / textarea / color -->
    <fieldset>
      <legend>Additional Preferences</legend>

      <div>
        <label for="deliveryDate">Preferred delivery date</label>
        <input type="date" id="deliveryDate" name="deliveryDate" required />
      </div>

      <div>
        <label for="orderNote">Order note</label>
        <textarea id="orderNote" name="orderNote" rows="3" cols="40" placeholder="배송 시 요청사항을 입력하세요."></textarea>
      </div>

      <div>
        <label for="favColor">Theme color</label>
        <input type="color" id="favColor" name="favColor" value="#0d6efd" />
      </div>
    </fieldset>

    <div>
      <button type="submit">Place Order</button>
      <button type="reset">Reset</button>
    </div>
  </form>

  <script>
    /* 에러 메시지 유틸 */
    function setError(input, message) {
      clearError(input);
      const anchor = (input.nextElementSibling && input.nextElementSibling.tagName === 'DIV')
        ? input.nextElementSibling : input;
      const msg = document.createElement('div');
      msg.className = 'error-msg';
      msg.textContent = message;
      anchor.insertAdjacentElement('afterend', msg);
      input.classList.remove('js-valid');
      input.classList.add('js-invalid');
      input.setAttribute('aria-invalid', 'true');
    }
    function clearError(input) {
      input.classList.remove('js-invalid', 'js-valid');
      input.removeAttribute('aria-invalid');
      const next = (input.nextElementSibling && input.nextElementSibling.classList && input.nextElementSibling.classList.contains('error-msg'))
        ? input.nextElementSibling
        : (input.nextElementSibling && input.nextElementSibling.nextElementSibling && input.nextElementSibling.nextElementSibling.classList && input.nextElementSibling.nextElementSibling.classList.contains('error-msg'))
          ? input.nextElementSibling.nextElementSibling
          : null;
      if (next) next.remove();
    }
    function setValid(input) { clearError(input); input.classList.add('js-valid'); }

    /* 카드번호 Luhn 검사 */
    function luhnCheck(numStr) {
      const s = numStr.replace(/\D/g, ''); let sum = 0, dbl = false;
      for (let i = s.length - 1; i >= 0; i--) {
        let d = +s[i]; if (dbl) { d *= 2; if (d > 9) d -= 9; }
        sum += d; dbl = !dbl;
      }
      return (s.length >= 13 && s.length <= 19) && (sum % 10 === 0);
    }

    /* 만료일 검사: MM/YY 또는 MM/YYYY, 미래 */
    function validateExpiry(val) {
      const m = val.match(/^(\d{2})\s*\/\s*(\d{2}|\d{4})$/);
      if (!m) return false;
      let mm = +m[1]; let yy = +m[2]; if (mm < 1 || mm > 12) return false;
      if (yy < 100) yy += 2000;
      const now = new Date();
      const exp = new Date(yy, mm, 1);        // 다음달 1일
      const nowCmp = new Date(now.getFullYear(), now.getMonth(), 1);
      return exp > nowCmp;
    }

    /* 필드 검증기 */
    const validators = {
      firstName: el => { const ok = el.value.trim().length >= 2; ok ? setValid(el) : setError(el, 'First name을 2글자 이상 입력하세요.'); return ok; },
      lastName:  el => { const ok = el.value.trim().length >= 2; ok ? setValid(el) : setError(el, 'Last name을 2글자 이상 입력하세요.'); return ok; },
      username:  el => { const ok = el.value.trim().length >= 2; ok ? setValid(el) : setError(el, 'Username을 2글자 이상 입력하세요.'); return ok; },
      address1:  el => { const ok = el.value.trim().length > 0; ok ? setValid(el) : setError(el, '주소를 입력하세요.'); return ok; },
      country:   el => { const ok = !!el.value; ok ? setValid(el) : setError(el, '국가를 선택하세요.'); return ok; },
      state:     el => { const ok = !!el.value; ok ? setValid(el) : setError(el, '지역을 선택하세요.'); return ok; },
      zip:       el => { const ok = /^[A-Za-z0-9\- ]{3,10}$/.test(el.value.trim()); ok ? setValid(el) : setError(el, '우편번호(3~10자, 영문/숫자/하이픈/공백).'); return ok; },
      ccName:    el => { const ok = el.value.trim().length >= 2; ok ? setValid(el) : setError(el, '카드 명의(2자 이상).'); return ok; },
      ccNumber:  el => { const ok = luhnCheck(el.value.replace(/\s+/g,'')); ok ? setValid(el) : setError(el, '유효한 카드번호가 아닙니다.'); return ok; },
      ccExpiration: el => { const ok = validateExpiry(el.value.trim()); ok ? setValid(el) : setError(el, '만료일은 MM/YY, 미래여야 합니다.'); return ok; },
      ccCvv:     el => { const ok = /^\d{3,4}$/.test(el.value.trim()); ok ? setValid(el) : setError(el, 'CVV는 숫자 3~4자리.'); return ok; },
      deliveryDate: el => { const ok = !!el.value; ok ? setValid(el) : setError(el, '배송 희망일을 선택하세요.'); return ok; }
    };

    /* 카드 필드 토글(PayPal 선택 시 비활성) */
    function toggleCardFields(disabled) {
      ['ccName','ccNumber','ccExpiration','ccCvv'].forEach(id => {
        const el = document.getElementById(id);
        el.disabled = disabled; if (disabled) { clearError(el); }
      });
    }

    /* 초기화 및 이벤트 바인딩 */
    window.addEventListener('DOMContentLoaded', () => {
      const form = document.forms['checkoutForm'];
      const promoForm = document.forms['promoForm'];

      /* onchange: select/date 즉시 검증 */
      ['country','state','deliveryDate'].forEach(id => {
        const el = document.getElementById(id); if (!el) return;
        el.addEventListener('change', () => validators[id](el));
      });

      /* input: 타이핑 중 실시간 검증 (PayPal이면 카드 필드 제외) */
      Object.keys(validators).forEach(id => {
        const el = document.getElementById(id); if (!el) return;
        el.addEventListener('input', () => {
          if (id.startsWith('cc') && form.paymentMethod.value === 'paypal') return;
          validators[id](el);
        });
      });

      /* onchange: 결제수단 */
      form.paymentMethod.forEach(r => {
        r.addEventListener('change', () => toggleCardFields(form.paymentMethod.value === 'paypal'));
      });

      /* onclick: Reset 시 confirm */
      const resetBtn = form.querySelector('button[type="reset"]');
      resetBtn.addEventListener('click', (e) => {
        if (!confirm('입력한 내용을 모두 지울까요?')) e.preventDefault();
      });

      /* onmouseover/onmouseout: 카트 카드 하이라이트 */
      const cartList = document.querySelector('aside ul');
      cartList.addEventListener('mouseover', () => cartList.classList.add('js-hover'));
      cartList.addEventListener('mouseout',  () => cartList.classList.remove('js-hover'));

      /* onkeydown: Zip 입력 허용 문자 제어(영문/숫자/Space/Hyphen) */
      const zip = document.getElementById('zip');
      zip.addEventListener('keydown', (e) => {
        const allowed = ['Backspace','Delete','ArrowLeft','ArrowRight','Tab'];
        if (allowed.includes(e.key)) return;
        if (e.key.length === 1 && !/[A-Za-z0-9\- ]/.test(e.key)) e.preventDefault();
      });

      /* 제출: 전체 검증 + confirm + alert */
      form.addEventListener('submit', (e) => {
        let ok = true;
        const usePayPal = form.paymentMethod.value === 'paypal';

        ['firstName','lastName','username','address1','country','state','zip','deliveryDate']
          .forEach(id => { const el = document.getElementById(id); if (el) ok = validators[id](el) && ok; });

        if (!usePayPal) {
          ['ccName','ccNumber','ccExpiration','ccCvv']
            .forEach(id => { const el = document.getElementById(id); if (el) ok = validators[id](el) && ok; });
        }

        if (!ok) {
          e.preventDefault();
          const firstErr = document.querySelector('.js-invalid'); if (firstErr) firstErr.scrollIntoView({behavior:'smooth', block:'center'});
          alert('입력값을 확인해 주세요.');
          return;
        }

        if (!confirm('주문을 제출할까요?')) { e.preventDefault(); return; }  // confirm 사용
        e.preventDefault();
        alert('주문이 정상적으로 제출되었습니다! (데모)');                 // alert 사용
      });

      /* Promo code: EXAMPLECODE */
      promoForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const codeInput = document.getElementById('promo');
        const code = codeInput.value.trim();
        const promoRow = document.querySelector('aside ul li:nth-child(4) div');

        if (!code) { setError(codeInput, '프로모 코드를 입력하세요.'); return; }
        if (code.toUpperCase() === 'EXAMPLECODE') {
          clearError(codeInput); setValid(codeInput);
          if (promoRow) promoRow.textContent = 'EXAMPLECODE (applied)';
          alert('프로모 코드가 적용되었습니다!');
        } else {
          setError(codeInput, '유효하지 않은 프로모 코드입니다.');
        }
      });

      /* 초기 상태: PayPal 선택 시 카드 필드 비활성 */
      toggleCardFields(form.paymentMethod.value === 'paypal');
    });
  </script>
</body>
</html>
